<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="libs/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="libs/bootstrap-slider.min.css">
	<title>Информационная система определения расходов интернет-магазина</title>
	<style>
		.h {
			height: 600px;
		}
	</style>
</head>
<body>
<div class="row" style="margin-top: 40px;">
 <div class="col-xs-5 col-xs-offset-1">
	<form class="form-horizontal" id="form1">
	  <fieldset>
	    <legend>Затраты</legend>
	    <div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Реклама
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Rl" placeholder="" value="4000">&nbsp;—&nbsp;<input type="number" required  min="1" class="form-control" style="display: inline; width: 30%;" id="Rr" placeholder="" value="16000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Аренда
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" required class="form-control" style="display: inline; width: 30%;" id="Al" placeholder="" value="2500">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Ar" placeholder="" value="15000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Зарплата
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Zl" placeholder="" value="26040">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Zr" placeholder="" value="78120"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Интернет
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Il" placeholder="" value="450">&nbsp;—&nbsp;<input type="number" required required min="1" class="form-control" style="display: inline; width: 30%;" id="Ir" placeholder="" value="800"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Сайт
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Sl" placeholder="" value="250">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Sr" placeholder="" value="1550"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label">
	     		Телефон
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Tl" placeholder="" value="100">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Tr" placeholder="" value="500"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label" style="padding-top: 0;">
	     		Количество товаров
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="count" placeholder="" value="100"> шт
	     	</div>
		</div>
		<div class="form-group">
	     	<label class="col-md-3 control-label" style="padding-top: 0;">
	     		Стоимость закупки
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required  style="display: inline; width: 30%;" id="Pl" placeholder="" value="4000">&nbsp;—&nbsp;<input type="number" required  min="1" class="form-control" style="display: inline; width: 30%;" id="Pr" placeholder="" value="16000"> руб
	     	</div>
		</div>
		<div class="form-group">
	      <label class="col-md-3 control-label">Желаемая прибыль</label>
	      <div class="col-md-9">
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios1" value="1">
	            небольшая
	          </label>
	        </div>
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios2" value="2" checked>
	            средняя
	          </label>
	        </div>	        
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios3" value="3">
	            высокая
	          </label>
	        </div>	        
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios4" value="4">
	            очень высокая
	          </label>
	        </div>
	      </div>
	    </div>
	    <div class="form-group">
	      <label class="col-md-3 control-label">Ставка налога</label>
	      <div class="col-md-9">
	        <div class="radio">
	          <label>
	            <input type="radio" name="tax" id="tax1" value="1" checked>
	            6%
	          </label>
	        </div>
	        <div class="radio">
	          <label>
	            <input type="radio" name="tax" id="tax2" value="2">
	            15%
	          </label>
	        </div>	       
	      </div>
	    </div>
	   
		
		<div class="form-group">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Удельный вес номенклатурной группы или модели
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="0.01" max = "1" step="0.01" class="form-control" required  style="display: inline; width: 60%;" id="W" placeholder="" value="0.5"> доли
	     	</div>
		</div>
	    <div class="form-group">
	      <div class="col-md-8 col-md-offset-2">
	        <button type="submit" class="btn btn-primary" style="width: 200px;">Расчет</button>	        
	        <button type="reset" id="reset1" class="btn btn-default">Сброс</button>
	      </div>
	    </div>
	  </fieldset>
	</form>
	</div>

	<div class="col-xs-5">
	<form class="form-horizontal" id="form2">
	  <fieldset>
		<legend>Корректировка</legend>
		 <div class="form-group">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Реклама
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="R2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Аренда
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="A2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Зарплата
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="Z2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Интернет
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="I2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Сайт
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="S2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Телефон
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="T2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label  class="col-md-3 control-label" style="padding-top: 0;">
	     		Стоимость закупки
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="P2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
	    <div class="form-group">
	      <div class="col-md-8 col-md-offset-2">
	        <button type="submit" class="btn btn-primary" style="width: 200px;">Пересчитать</button>	        
	        <button type="reset" id="reset2" class="btn btn-default">Сброс</button>
	      </div>
	    </div><br><br>
	    <legend>Результат</legend>
	    <div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		Общие затраты
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res1" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		Себестоимость единицы товара
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res2" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		УСН на единицу товара
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res3" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div><br><br>
		<legend>Результат после корректировки</legend>
	    <div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		Общие затраты
	     	</label>
	     	<div class="col-md-8">
	     		<p id="info" ></p>	
	     		<input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res4" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		Себестоимость единицы товара
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res5" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label  class="col-md-3 control-label">
	     		УСН на единицу товара
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res6" placeholder="" value="" disabled = "disabled"> руб
	     	</div>
		</div>
		<div class="form-group">
			<label  class="col-md-3 control-label">
				Цена единицы товара с учетом УСН
			</label>
			<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res7" placeholder="" value="" disabled = "disabled"> руб
			</div>
		</div>
	  </fieldset>
	</form>
	</div>
	</div>
	<div class="row">
        <div class="col-md-10 col-md-offset-4" style="margin-top: 40px;">
            <div class="form-group">
                <button id="btn_dg" class="btn btn-primary" >Построить диаграмму</button>
                <button id="btn_dg_reset" class="btn btn-default">Очистить диаграмму</button>
                <a href="index2.html" class="btn btn-success">Перейти к нечеткой логике</a>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
            <div class="chart" style="display: none;">
                <canvas id="barChart" style="height:230px"></canvas>
            </div>
        </div>
    </div>
	<div class="h">&nbsp;</div>
	<script src="libs/jquery.min.js"></script>
    <script src="libs/bootstrap-slider.min.js"></script>
    <script src="libs/chartjs/Chart.min.js"></script>
    <script>
        $(function () {

        var nms = ['R','A','Z','I','S','T','P'];

        localStorage.setItem('fdata',JSON.stringify(getInputs()));

		//получение данных из одного поля формы 
    	function parseInp(name)
    	{
			return [parseInt($('#'+name+'l').val()), parseInt($('#'+name+'r').val()), name];
    	}

    	//получение данных полей о расходах
    	function getInputs()
    	{
    		var inp = [];
    		for(var i=0; i<nms.length; i++) {
    			inp.push(parseInp(nms[i]));
    		}
    		return inp;
    	}

    	// установка начальных значений в форме со скроллами
    	function initSliders()
    	{
    		var inp = getInputs();
    		for(var i=0; i<inp.length; i++)
    		{
    			$("#"+inp[i][2]+"2").slider({step: 1, min: inp[i][0], max: inp[i][1], value: (inp[i][0]+inp[i][1])/2 });
    		}
    	}

    	//обновление данных в полях со скроллами
    	function refreshSliders()
    	{
    		var inp = getInputs();
    		for(var i=0; i<inp.length; i++)
    		{
    			$("#"+inp[i][2]+"2").slider('destroy');
    			$("#"+inp[i][2]+"2").slider({step: 1, min: inp[i][0], max: inp[i][1], value: (inp[i][0]+inp[i][1])/2 });
    		}
    	}

    	//получение данных с первой формы
    	function getInputs2()
    	{
    		var inp = [];
    	
    		inp.push(parseInt($('#count').val()));
    		inp.push(parseInt($('input[name=B]:checked','#form1').val()));
    		inp.push(parseInt($('input[name=tax]:checked','#form1').val()));
			inp.push(parseFloat($('#W').val()));

    		return inp;
    	}

    	//получение данных с формы со скроллами
    	function getInputsCorrect()
    	{
    		var inp = [];

    		for(var i=0; i<nms.length; i++) {
    			inp.push(parseInt($('#'+nms[i]+'2').val()));
    		}

    		return inp;
    	}

    	//вывод данных после корректировки
    	function setRes2(x)
    	{
    		if(x.length) {
				$('#res4').val(x[0]);
    			$('#res5').val(x[1]);
    			$('#res6').val(x[2]);
                $('#res7').val(x[3]);
    			$('#info').text(x[4]);
    		} else { //очистить поля
    			$('#res4').val('');
    			$('#res5').val('');
    			$('#res6').val('');
                $('#res7').val('');
    			$('#info').text('');
    		}
    	}

    	//вывод данных 
		function setRes(x)
    	{
    		if(x.length) {
				$('#res1').val(x[0]);
    			$('#res2').val(x[1]);
    			$('#res3').val(x[2]);
    		} else {//очистить поля
    			$('#res1').val('');
    			$('#res2').val('');
    			$('#res3').val('');
    		}
    	}

    	//подсчет результатов
    	function calculate()
    	{
			var inp = getInputs();
    		var inp2 = getInputs2();
    		
    		//обнуляем результаты после корректировки
    		setRes2([]);

    		var Z = 0;
			var Z2 = 0;
    		var P = (inp[nms.length-1][1] - inp[nms.length-1][0])/2; //средняя стоимость закупки

    		// общие расходы
    		for(var i=0; i<nms.length-1; i++) {
    			Z += (inp[i][0]+inp[i][1])/2;
				
    		}
			Z2 = Z-P;
			
    		var C = (((Z-P)*inp2[3]/inp2[0]) + (P/inp2[0])); //
    		
			
			//расчет прибыли
			var Pr = 0;
			if (inp2[1] == 1) {  
			Pr = C*0.1;
			}
			
			if (inp2[1] == 2) {  
			Pr = C*0.2;
			}
			
			if (inp2[1] == 3) {
			Pr = C*0.5;
			}
			
			else if (inp2[1] == 4) {
			Pr = C*0.7;
			}
			
			var USN = 0;
			if(inp2[2] == 1) { //6%
    			USN = ((C + Pr)*0.06)/0.94; 
    		} 
			
			else {//15%
			
    			USN = Pr*0.15; //
    		}

    		//показ общих расходов, себестоимости и усн
    		setRes([Math.round(Z2),Math.round(C),Math.round(USN)]);

    		refreshSliders();
    	}

    	//определение категории значения С 
    	function getCategory(a,b,c)
    	{
    		var h = (b-a)/3;
    		if(c<a+h)
    			return 1;
    		if (c<a+2*h)
    			return 2;
    		return 3;
    	}

    	//перевод категории в текст
    	function resToRus(x)
    	{
    		if (x==1)
    			return 'низкие';
    		if (x==2)
    			return 'средние';
    		if (x==3)
    			return 'высокие';
    		return '';
    	}

    	//определение категории расходов
    	function getInfo(inpc)
    	{

    		var inp = getInputs();
    		var cats = [];
    		for(var i=0; i<nms.length; i++) {
    			cats.push(getCategory(inp[i][0],inp[i][1],inpc[i]));
    		}

    		//проверка правил
    		if(cats[0]==1 && cats[1]==1 && cats[2]==1 && cats[3]==1 && cats[4]==1 && cats[5]==1)
    			return resToRus(1);
    		if(cats[0]==2 && cats[1]==2 && cats[2]==2 && cats[3]==2 && cats[4]==2 && cats[5]==2)
    			return resToRus(2);
    		if(cats[0]==3 && cats[1]==3 && cats[2]==3 && cats[3]==3 && cats[4]==3 && cats[5]==3)
    			return resToRus(3);

    		return resToRus(Math.round((cats[0]+cats[1]+cats[2])/3));
    	}

    	//корректировка результатов
    	function calculate2()
    	{
    		var inp = getInputsCorrect();
    		var inp2 = getInputs2();
    		
    		var Z = 0;
			var Z2 = 0;
    		var P = inp[6]; //стоимость закупки 

    		// общие расходы
    		for(var i=0; i<nms.length; i++)
    		{
    			Z += inp[i];
    		}
			Z2 = Z - P;
			
    		var C = (((Z-P)*inp2[3]/inp2[0]) + (P/inp2[0])); // себестоимость
    		
			//расчет прибыли
			var Pr = 0;
			if (inp2[1] == 1) { 
			Pr = C*0.1;
			}
			
			if (inp2[1] == 2) {  
			Pr = C*0.2;
			}
			
			if (inp2[1] == 3) {  
			Pr = C*0.5;
			}
			
			else if (inp2[1] == 4) { 
			Pr = C*0.7;
			}
			
			var USN = 0;
			if(inp2[2] == 1)			//6%
			{
			USN = ((C + Pr)*0.06)/0.94;
			}
			
    		else //15%
    		{
    			USN = Pr*0.15;
    		}
			
			var Price = Pr + USN + C;
			
    		//показ общих расходов, себестоимости и усн
    		setRes2([Math.round(Z2),Math.round(C),Math.round(USN),Math.round(Price), getInfo(inp)]);
    	}

    	//при загрузке формы установка начальных значений на форме со скроллами
    	$(document).ready(function(){
    		initSliders();
    	});

    	//нажатие кнопки Расчет
    	$('#form1').submit(function(){
            localStorage.setItem('fdata',JSON.stringify(getInputs()));
    		calculate();
    		return false;
    	});

    	//нажатие кнопки Пересчитать
		$('#form2').submit(function(){
    		calculate2();
    		return false;
    	});

    	//сброс значений формы и результатов
    	$('#reset1').click(function(){
    		setRes([]);
			setRes2([]);
    	});

    	//сброс результатов после корректировки и формы со скроллами
    	$('#reset2').click(function(){
			setRes2([]);
			refreshSliders();
			return false;
    	});


    	//прячем диаграмму при клике на кнопку
        $('#btn_dg_reset').click(function() {
            $('.chart').hide();
        });

    	//строим диаграмму при клике на кнопку
    	$('#btn_dg').click(function() {

            $('.chart').show();

            var areaChartData = {
                labels: ['Реклама', 'Аренда', 'Зарплата', 'Интернет', 'Сайт', 'Телефон', 'Стоимость закупки'],
                datasets: [{
                    fillColor: "rgba(210, 214, 222, 1)",
                    strokeColor: "rgba(210, 214, 222, 1)",
                    pointColor: "rgba(210, 214, 222, 1)",
                    pointStrokeColor: "#c1c7d1",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: getInputsCorrect()
                },
                ]
            };

            var barChartCanvas = $("#barChart").get(0).getContext("2d");
            barChartCanvas.canvas.height = 500;
            var barChart = new Chart(barChartCanvas);
            var barChartData = areaChartData;
            barChartData.datasets[0].fillColor = "#00a65a";
            barChartData.datasets[0].strokeColor = "#00a65a";
            barChartData.datasets[0].pointColor = "#00a65a";
            var barChartOptions = {
                scaleBeginAtZero: true,
                scaleShowGridLines: true,
                scaleGridLineColor: "rgba(0,0,0,.05)",
                scaleGridLineWidth: 1,
                scaleShowHorizontalLines: true,
                scaleShowVerticalLines: true,
                barShowStroke: true,
                barStrokeWidth: 2,
                barValueSpacing: 5,
                barDatasetSpacing: 1,
                legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].fillColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>",
                responsive: true,
                maintainAspectRatio: false
            };

            barChartOptions.datasetFill = false;
            barChart.Bar(barChartData, barChartOptions);

        });

        });
    </script>
</body>
</html>
