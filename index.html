<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="libs/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="libs/bootstrap-slider.min.css">
	<title>Расчет расходов интернет-магазина</title>
	<style>
		.h {
			height: 600px;
		}
	</style>
</head>
<body>
<div class="row" style="margin-top: 40px;">
 <div class="col-xs-5 col-xs-offset-1">
	<form class="form-horizontal" id="form1">
	  <fieldset>
	    <legend>Расходы</legend>
	    <div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Реклама
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Rl" placeholder="" value="4000">&nbsp;—&nbsp;<input type="number" required  min="1" class="form-control" style="display: inline; width: 30%;" id="Rr" placeholder="" value="16000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Аренда
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" required class="form-control" style="display: inline; width: 30%;" id="Al" placeholder="" value="2500">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Ar" placeholder="" value="15000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Зарплата
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Zl" placeholder="" value="26040">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Zr" placeholder="" value="78120"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Интернет
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Il" placeholder="" value="450">&nbsp;—&nbsp;<input type="number" required required min="1" class="form-control" style="display: inline; width: 30%;" id="Ir" placeholder="" value="800"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Сайт
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Sl" placeholder="" value="250">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Sr" placeholder="" value="1550"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Телефон
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="Tl" placeholder="" value="1">&nbsp;—&nbsp;<input type="number" required min="1" class="form-control" style="display: inline; width: 30%;" id="Tr" placeholder="" value="500"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Количество товаров
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 30%;" id="count" placeholder="" value="100">
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Стоимость закупки
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required  style="display: inline; width: 30%;" id="Pl" placeholder="" value="4000">&nbsp;—&nbsp;<input type="number" required  min="1" class="form-control" style="display: inline; width: 30%;" id="Pr" placeholder="" value="16000"> руб
	     	</div>
		</div>
		<div class="form-group">
	      <label class="col-md-3 control-label">Желаемая прибыль</label>
	      <div class="col-md-9">
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios1" value="1" checked>
	            небольшая
	          </label>
	        </div>
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios2" value="2">
	            средняя
	          </label>
	        </div>	        
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios3" value="3">
	            высокая
	          </label>
	        </div>	        
	        <div class="radio">
	          <label>
	            <input type="radio" name="B" id="optionsRadios4" value="4">
	            очень высокая
	          </label>
	        </div>
	      </div>
	    </div>
	    <div class="form-group">
	      <label class="col-md-3 control-label">Ставка налога</label>
	      <div class="col-md-9">
	        <div class="radio">
	          <label>
	            <input type="radio" name="tax" id="tax1" value="1" checked>
	            6%
	          </label>
	        </div>
	        <div class="radio">
	          <label>
	            <input type="radio" name="tax" id="tax2" value="2">
	            15%
	          </label>
	        </div>	       
	      </div>
	    </div>
	    <div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Доходы
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required style="display: inline; width: 60%;" id="D" placeholder="" value="75000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Сумма уплаченных страховых взносов
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" min="1" class="form-control" required  style="display: inline; width: 60%;" id="U" placeholder="" value="1000"> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Удельный вес номенклатурной группы или модели
	     	</label>
	     	<div class="col-md-8">
	     		<input type="number" step="0.01" class="form-control" required  style="display: inline; width: 60%;" id="W" placeholder="" value="0.25">
	     	</div>
		</div>
	    <div class="form-group">
	      <div class="col-md-8 col-md-offset-2">
	        <button type="submit" class="btn btn-primary" style="width: 200px;">Расчет</button>	        
	        <button type="reset" id="reset1" class="btn btn-default">Сброс</button>
	      </div>
	    </div>
	  </fieldset>
	</form>
	</div>
	<div class="col-xs-5">
	<form class="form-horizontal" id="form2">
	  <fieldset>
		<legend>Корректировка</legend>
		 <div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Реклама
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="R2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		  <div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Аренда
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="A2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Зарплата
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="Z2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Интернет
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="I2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Сайт
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="S2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Телефон
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="T2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
		<div class="form-group" style="margin-top: 22px;">
	     	<label for="inputPassword" class="col-md-3 control-label" style="padding-top: 0;">
	     		Стоимость закупки
	     	</label>
	     	<div class="col-md-8">
	     		<input type="text" class="form-control" style="display: inline; width: 80%;" id="P2" data-slider-min="10" data-slider-max="1000" data-slider-step="1" data-slider-value="250"> &nbsp;руб
	     	</div>
		</div>
	    <div class="form-group">
	      <div class="col-md-8 col-md-offset-2">
	        <button type="submit" class="btn btn-primary" style="width: 200px;">Пересчитать</button>	        
	        <button type="reset" id="reset2" class="btn btn-default">Сброс</button>
	      </div>
	    </div><br><br>
	    <legend>Результат</legend>
	    <div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Общие расходы
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res1" placeholder="" value=""> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Себестоимость
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res2" placeholder="" value=""> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		УСН
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res3" placeholder="" value=""> 
	     	</div>
		</div><br><br>
		<legend>Результат после корректировки</legend>
	    <div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Общие расходы
	     	</label>
	     	<div class="col-md-8">
	     		<p id="info" ></p>	
	     		<input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res4" placeholder="" value=""> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		Себестоимость
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res5" placeholder="" value=""> руб
	     	</div>
		</div>
		<div class="form-group">
	     	<label for="inputPassword" class="col-md-3 control-label">
	     		УСН
	     	</label>
	     	<div class="col-md-8"><input type="number" min="1" class="form-control" style="display: inline; width: 60%;" id="res6" placeholder="" value=""> 
	     	</div>
		</div>
	  </fieldset>
	</form>
	</div>
	</div>
	<div class="h">&nbsp;</div>
	<script type='text/javascript' src="libs/jquery.min.js"></script>
    <script type='text/javascript' src="libs/bootstrap-slider.min.js"></script>
    <script>
        var nms = ['R','A','Z','I','S','T','P'];

    	//получение данных из одного поля формы
		function parseInp(name)
    	{
			return [parseInt($('#'+name+'l').val()), parseInt($('#'+name+'r').val()), name];
    	}

    	//получение данных с полей о расходах
		function getInputs()
    	{
    		var inp = [];
    		for(var i=0; i<nms.length; i++)
    		{
    			inp.push(parseInp(nms[i]));
    		}
    		return inp;
    	}

    	//установка начальных значений в форме со слайдером
		function initSliders()
    	{
    		var inp = getInputs();
    		for(var i=0; i<inp.length; i++)
    		{
    			$("#"+inp[i][2]+"2").slider({step: 1, min: inp[i][0], max: inp[i][1], value: (inp[i][0]+inp[i][1])/2 });
    		}
    	}

    	//обновление данных слайдера
		function refreshSliders()
    	{
    		var inp = getInputs();
    		for(var i=0; i<inp.length; i++)
    		{
    			$("#"+inp[i][2]+"2").slider('destroy');
    			$("#"+inp[i][2]+"2").slider({step: 1, min: inp[i][0], max: inp[i][1], value: (inp[i][0]+inp[i][1])/2 });
    		}
    	}

    	//получение данных с первой формы
		function getInputs2()
    	{
    		var inp = [];
    	
    		inp.push(parseInt($('#count').val()));
    		inp.push(parseInt($('input[name=B]:checked','#form1').val()));
    		inp.push(parseInt($('input[name=tax]:checked','#form1').val()));
    		inp.push(parseInt($('#D').val()));
			inp.push(parseInt($('#U').val()));
			inp.push(parseFloat($('#W').val()));

    		return inp;
    	}

		//вывод данных перед корректировкой
		function setRes(x)
    	{
    		if(x.length)
    		{
				$('#res1').val(x[0]);
    			$('#res2').val(x[1]);
    			$('#res3').val(x[2]);
    		}
    		else
    		{
    			$('#res1').val('');
    			$('#res2').val('');
    			$('#res3').val('');
    		}
    	}

    	//подсчет результатов
		function calculate()
    	{
			var inp = getInputs();
    		var inp2 = getInputs2();
    		
    		//обнуляем результаты после корректировки
    		//setRes2([]);

    		var Z = 0;
    		var P = (inp[nms.length-1][0]+inp[nms.length-1][1])/2; //средняя стоимость закупки

    		// общие расходы
    		for(var i=0; i<nms.length-1; i++)
    		{
    			Z += (inp[i][0]+inp[i][1])/2;
    		}

    		var C = Z*inp2[5]/inp2[0] + P; //себестоимость
    		var USN = 0;

			if(inp2[2] == 1) //6%
    		{
    			USN = inp2[3]*0.06 - inp2[4];
    		}
    		else //15%
    		{
    			USN = (inp2[3]-Z)*0.15;
    		}

    		//показ общих расходов, себестоимости и усн
    		setRes([Math.round(Z),Math.round(C),Math.round(USN)]);

    		refreshSliders();
    	}

    	//определение категории значения С на промежутке AB
    	function getCategory(a,b,c)
    	{
    		var h = (b-a)/3;
    		if(c<a+h)
    			return 1;
    		if (c<a+2*h)
    			return 2;
    		return 3;
    	}

    	//перевод категории в текст
    	function resToRus(x)
    	{
    		if (x==1)
    			return 'низкие';
    		if (x==2)
    			return 'средние';
    		if (x==3)
    			return 'высокие';
    		return '';
    	}

    	//определение категории расходов
    	function getInfo(inpc)
    	{
    		//['R','A','Z','I','S','T','P'];
    		var inp = getInputs();
    		var rules = [];
    		for(var i=0; i<nms.length; i++)
    		{
    			rules.push(getCategory(inp[i][0],inp[i][1],inpc[i]));
    		}

    		//проверка на условия какой уровень расходов (правила)
    		if(rules[0]==1 && rules[1]==1 && rules[2]==1 && rules[3]==1 && rules[4]==1 && rules[5]==1)
    			return resToRus(1);
    		if(rules[0]==2 && rules[1]==2 && rules[2]==2 && rules[3]==2 && rules[4]==2 && rules[5]==2)
    			return resToRus(2);
    		if(rules[0]==3 && rules[1]==3 && rules[2]==3 && rules[3]==3 && rules[4]==3 && rules[5]==3)
    			return resToRus(3);

    		return resToRus(Math.round((rules[0]+rules[1]+rules[2])/3));
    	}

    	//корректировка результатов
    	function calculate2()
    	{
    		var inp = getInputsCorrect();
    		var inp2 = getInputs2();
    		
    		var Z = 0;
    		var P = inp[6]; //стоимость закупки

    		// общие расходы
    		for(var i=0; i<nms.length; i++)
    		{
    			Z += inp[i];
    		}

    		var C = Z*inp2[5]/inp2[0] + P; //себестоимость
    		var USN = 0;

			if(inp2[2] == 1) //6%
    		{
    			USN = inp2[3]*0.06 - inp2[4];
    		}
    		else //15%
    		{
    			USN = (inp2[3]-Z)*0.15;
    		}

    		//показ общих расходов, себестоимости и усн
    		setRes2([Math.round(Z),Math.round(C),Math.round(USN),getInfo(inp)]);
    	}

    	//при загрузке формы установка начальных значений на форме со скроллами
    	$(document).ready(function(){
    		initSliders();
    	});

    	//нажатие кнопки Расчет
    	$('#form1').submit(function(){
    		calculate();
    		return false;
    	});

    	//нажатие кнопки Пересчитать
		$('#form2').submit(function(){
    		calculate2();
    		return false;
    	});

    	//сброс значений формы и результатов
    	$('#reset1').click(function(){
    		setRes([]);
			setRes2([]);
    	});

    	//сброс результатов после корректировки и формы со скроллами
    	$('#reset2').click(function(){
			setRes2([]);
			refreshSliders();
			return false;
    	});

    </script>
</body>
</html>
